---
import Layout from '../layouts/Layout.astro';
import background from '../assets/img/background.jpg'
import type { Event } from '../../types/event.interface';
import Container from '../components/Container.astro';

const response = await fetch('https://gospeak.io/api/groups/humantalks-paris/events');
const data: { data: Event[] } = await response.json();
const events: Event[] = data.data

const videos = events.reduce((all, event) => {
  const allVideos = event.proposals.reduce((p, v) => {
    return v.video ? [ ...p, v.video.replace('watch?v=', 'embed/') ] : p
  }, [])

  return [ ...all, ...allVideos ]
}, [])

---

<Layout title="VidÃ©os">
  <div class="bg-fixed bg-no-repeat fixed top-0 left-0 right-0 bottom-0 opacity-50" style={{ backgroundImage: `url(${background.src})`, backgroundSize: '50%', backgroundPosition: '100% 0%' }} />

  <Container class="justify-center grid grid-cols-1 sm:grid-cols-2 gap-4 !max-w-5xl py-16">
    { videos.map(video => (
      <div class="aspect-video relative overflow-hidden rounded-xl">
        <iframe width="100%" height="100%" src={video} title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>
    )) }
  </Container>
</Layout>